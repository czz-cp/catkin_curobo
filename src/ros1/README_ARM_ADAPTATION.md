# NavRLæœºæ¢°è‡‚é€‚é…ç‰ˆæœ¬

æœ¬æ–‡æ¡£è®°å½•äº†å¯¹NavRLä»£ç åº“è¿›è¡Œçš„æœºæ¢°è‡‚é€‚é…ä¿®æ”¹ã€‚

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. onboard_detectorï¼ˆéšœç¢ç‰©æ£€æµ‹å™¨ï¼‰
#### é…ç½®æ–‡ä»¶
- `cfg/detector_param.yaml`
  - è¯é¢˜åç§°ï¼š`/CERLAB/quadcopter/pose` â†’ `/arm/pose`
  - ç›¸æœºå‚æ•°ï¼šé€‚é…Realsense D435i
  - å·¥ä½œèŒƒå›´ï¼š`5.0m` â†’ `2.0m`
  - æ£€æµ‹å‚æ•°ï¼šé€‚é…æœºæ¢°è‡‚ç¯å¢ƒ

#### C++ä»£ç 
- `include/onboard_detector/dynamicDetector.cpp`
  - é»˜è®¤è¯é¢˜åç§°é€‚é…æœºæ¢°è‡‚

- `include/onboard_detector/dynamicDetector.h`
  - ä¼ æ„Ÿå™¨èŒƒå›´ï¼š`{5.0, 5.0, 5.0}` â†’ `{2.0, 2.0, 2.0}`

#### å¯åŠ¨æ–‡ä»¶
- `launch/run_arm_detector.launch`ï¼ˆæ–°å¢ï¼‰
  - æœºæ¢°è‡‚ä¸“ç”¨å¯åŠ¨æ–‡ä»¶

### 2. map_managerï¼ˆåœ°å›¾ç®¡ç†å™¨ï¼‰
#### é…ç½®æ–‡ä»¶
- `cfg/occupancy_map_param.yaml`
  - è¯é¢˜åç§°ï¼š`/CERLAB/quadcopter/pose` â†’ `/arm/pose`
  - æœºå™¨äººå°ºå¯¸ï¼š`[0.3, 0.3, 0.1]` â†’ `[0.15, 0.15, 0.2]`
  - åœ°å›¾åˆ†è¾¨ç‡ï¼š`0.1m` â†’ `0.02m`ï¼ˆæ›´é«˜ç²¾åº¦ï¼‰
  - åœ°å›¾å°ºå¯¸ï¼š`[60, 60, 5]` â†’ `[2.0, 2.0, 1.5]`ï¼ˆæœºæ¢°è‡‚å·¥ä½œç©ºé—´ï¼‰

#### C++ä»£ç 
- `include/map_manager/occupancyMap.cpp`
  - é»˜è®¤è¯é¢˜åç§°é€‚é…æœºæ¢°è‡‚
  - é»˜è®¤æœºå™¨äººå°ºå¯¸é€‚é…æœºæ¢°è‡‚

#### å¯åŠ¨æ–‡ä»¶
- `launch/occupancy_map_arm.launch`ï¼ˆæ–°å¢ï¼‰
  - æœºæ¢°è‡‚ä¸“ç”¨åœ°å›¾å¯åŠ¨æ–‡ä»¶

## ğŸ¯ ä¸»è¦é€‚é…å˜åŒ–

### è¯é¢˜æ˜ å°„
| NavRLåŸå§‹ | æœºæ¢°è‡‚é€‚é… |
|-----------|------------|
| `/CERLAB/quadcopter/pose` | `/arm/pose` |
| `/CERLAB/quadcopter/odom` | `/arm/odom` |
| `/camera/depth/image_raw` | ä¿æŒä¸å˜ |

### å‚æ•°è°ƒæ•´
| å‚æ•° | NavRLåŸå§‹ | æœºæ¢°è‡‚é€‚é… |
|------|-----------|------------|
| æœºå™¨äººå°ºå¯¸ | `[0.3, 0.3, 0.1]` | `[0.15, 0.15, 0.2]` |
| åœ°å›¾åˆ†è¾¨ç‡ | `0.1m` | `0.02m` |
| åœ°å›¾å°ºå¯¸ | `[60, 60, 5]` | `[2.0, 2.0, 1.5]` |
| æ£€æµ‹èŒƒå›´ | `5.0m` | `2.0m` |
| èšç±»ç‚¹æ•° | `20` | `15` |

### åæ ‡ç³»å˜åŒ–
- **æ— äººæœº**ï¼šquadcopter â†’ world
- **æœºæ¢°è‡‚**ï¼štool0_controller â†’ base_link

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ç¼–è¯‘NavRLï¼ˆæœºæ¢°è‡‚é€‚é…ç‰ˆæœ¬ï¼‰
```bash
cd /home/zar/Downloads/curobo/NavRL/ros1
catkin_make
source devel/setup.bash
```

### ç¼–è¯‘æœºæ¢°è‡‚è§„åˆ’å™¨
```bash
cd /home/zar/Downloads/curobo/robot_arm_planner
catkin_make
source devel/setup.bash
```

### å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
```bash
roslaunch robot_arm_planner robot_arm_planner_navrl.launch
```

## ğŸ”§ æµ‹è¯•å‘½ä»¤

### æ£€æŸ¥è¯é¢˜å‘å¸ƒ
```bash
# æ£€æŸ¥æœºæ¢°è‡‚ä½å§¿
rostopic echo /arm/pose

# æ£€æŸ¥åœ°å›¾æ•°æ®
rostopic echo /occupancy_map/inflated_voxel_map

# æ£€æŸ¥éšœç¢ç‰©æ£€æµ‹
rostopic echo /dynamic_obstacles/tracked_bboxes
```

### è°ƒç”¨æœåŠ¡
```bash
# ç¢°æ’æ£€æµ‹
rosservice call /arm_map/check_collision "position: {x: 0.5, y: 0.0, z: 0.5}"

# å…‰çº¿æŠ•å°„
rosservice call /arm_map/raycast
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### ä¼˜åŠ¿
- âœ… ä½¿ç”¨NavRLçš„åŸç”Ÿç®—æ³•ï¼ˆDBSCANã€å¡å°”æ›¼æ»¤æ³¢ç­‰ï¼‰
- âœ… ä¿æŒNavRLçš„é«˜æ•ˆå¤„ç†èƒ½åŠ›
- âœ… å®Œå…¨å…¼å®¹NavRLçš„æ¥å£æ ¼å¼
- âœ… é’ˆå¯¹æœºæ¢°è‡‚ç¯å¢ƒä¼˜åŒ–å‚æ•°

### é™åˆ¶
- åœ°å›¾èŒƒå›´è¾ƒå°ï¼ˆé€‚åˆæœºæ¢°è‡‚å·¥ä½œç©ºé—´ï¼‰
- æ£€æµ‹ç²¾åº¦æ›´é«˜ï¼ˆéœ€è¦æ›´å¤šè®¡ç®—èµ„æºï¼‰
- æ·±åº¦èŒƒå›´é™åˆ¶ï¼ˆ2.0mä»¥å†…ï¼‰

## ğŸ”„ ç³»ç»Ÿæ¶æ„

```
Realsense D435i
    â†“
NavRL onboard_detector (æœºæ¢°è‡‚é€‚é…ç‰ˆ)
    â†“
NavRL map_manager (æœºæ¢°è‡‚é€‚é…ç‰ˆ)
    â†“
navrl_adapter (æ•°æ®æ ¼å¼è½¬æ¢)
    â†“
cuRobo (è·¯å¾„è§„åˆ’)
    â†“
UR10e (æ§åˆ¶æ‰§è¡Œ)
```

è¿™ä¸ªé€‚é…ç‰ˆæœ¬ä¿æŒäº†NavRLçš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒæ—¶å®Œç¾é€‚é…äº†æœºæ¢°è‡‚çš„åº”ç”¨åœºæ™¯ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024å¹´
**å…¼å®¹æ€§**: NavRL + cuRobo + UR10e